<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Setting - Velog </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/setPage/styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<link th:href="@{/css/headerStyle.css}" rel="stylesheet">
  </head>   
  <body>

  <!-- 프로필 메인 영역 시작 -->
  <div id="header" th:replace="fragments/header :: header" ></div>
<main class="container-md mainframe">

  <section class="Profile-main">
    <div class="thumbnail-area">
      <img src="img/devJeans.png" onerror="this.src='/kdy/imgs/noImage.png'"
      alt=""
      id="profile-image">
        <button color="teal" id="UPB">이미지 업로드</button>
        <button color="transparent" id="RMB">이미지 제거</button>
    </div>
    <div class="info-area">

      <!-- default 값 -->
      <div class="defaultInfo" id="defInfo">
        <h2 class="vUsername" th:text="${member.userName != null && member.userName != '' ? member.userName : '입력된 이름이 없습니다.'}"></h2>
        <p class="vUserBio" th:text="${member.userBio != null && member.userBio != '' ? member.userBio : '입력된 한 줄 소개가 없습니다.'}"></p>
        <button class="edit-button" id="editButton_Mp">수정</button>
      </div>

      <!-- 숨겨진 항목 (수정 버튼 클릭시 나오는 영역) -->
      <div id="defInfo_editForm" style="display : none;">
        <form class="edit_mainForm" method="post"
              id="editForm"
              th:action="@{/members/setPage/{memberId}/edit(memberId=${member.memberId})}">
          <input placeholder="이름" class="textArea vName_e" name="userName"
                 value="" th:value="${member.userName}">
          <input placeholder="한 줄 소개" class="textArea vBio_e" name="userBio"
                 value="" th:value="${member.userBio}">
            <div class="button-wrapper">
              <button color="teal" class="save-button" id="save-btn-info">저장</button>
            </div>
        </form>
      </div> 

    </div>
  </section>

  <!-- ====== 프로필 디테일 영역 시작 ====== -->
  <section class="Profile-detail">

    <!-- 벨로그 제목 영역 시작 -->
    <div class="pd p_dt">
      <div class="wrapper">
        <div class="title-wrapper">
          <h3>벨로그 제목</h3>
        </div>
        <div class="block-set" >

          <!-- default 값 -->
            <div class="block-set" id="vPageName">
              <div class="contents" id="vPageNameT"
                   th:text="${member.velogPageName}"></div>
              <div class="edit-wrapper">
                <button class="edit-button" id="editButton_vN">수정</button>
              </div>
            </div>
         
         
          <!-- 숨겨진 항목 (수정 버튼 클릭시 나오는 영역) -->
          <div class="contents" id="vPageName_editForm" style="display: none;">
            <form class="vName_editForm" id="editForm2" method="post" th:action="@{/members/setPage/{memberId}/edit2(memberId=${member.memberId})}">
              <input placeholder="벨로그 제목" id="vPageNameT_e" name="velogPageName"
                     th:value="${member.velogPageName}">
              <button color="teal" class="save-button" id="save-btn-PageName">저장</button>
            </form>
          </div>
          
        </div>
      </div>
      <div class="description">개인 페이지의 좌측 상단에 나타나는 페이지 제목입니다.</div>
    </div>

    <!-- 소셜 정보 영역 시작 -->
    <div class="pd p_dt" id="social-infoset">
      <div class="wrapper">
        <div class="title-wrapper">
          <h3>소셜 정보</h3>
        </div>
        <div class="block-set">

          <!-- default 값 -->
          <div class="block-set" id="snsInfo">
            <div class="contents">
              <ul class="social-info-textlist">
                <li>
                  <img class="icons" src="/setPage/img/email-icon.svg" onerror="this.src='/kdy/imgs/noImage.png'" alt="email">
                  <div id="snsEmail" th:text="${member.userEmail != null && member.userEmail != '' ? member.userEmail : '입력된 이메일이 없습니다.'}"></div>
                </li>
                <li>
                  <img class="icons" src="/setPage/img/github-icon.svg" onerror="this.src='/kdy/imgs/noImage.png'" alt="github">
                  <div id="snsGithub" th:text="${sns.userGithub != null && sns.userGithub != '' ? sns.userGithub : '입력된 Github 링크가 없습니다.'}"></div>
                </li>
                <li>
                  <img class="icons" src="/setPage/img/twitter-icon.svg" onerror="this.src='/kdy/imgs/noImage.png'" alt="home">
                  <div id="snsTwitter" th:text="${sns.userTwitter != null && sns.userTwitter != '' ? sns.userTwitter : '입력된 Twitter 링크가 없습니다.'}"></div>
                </li>
                <li>
                  <img class="icons" src="/setPage/img/facebook-icon.svg" onerror="this.src='/kdy/imgs/noImage.png'" alt="home">
                  <div id="snsFacebook" th:text="${sns.userFacebook != null && sns.userFacebook != '' ? sns.userFacebook : '입력된 Facebook 링크가 없습니다.'}"></div>
                </li>
                <li>
                  <img class="icons" src="/setPage/img/home-icon.svg" onerror="this.src='/kdy/imgs/noImage.png'" alt="home">
                  <div id="snsHome" th:text="${sns.userHomepage != null && sns.userHomepage != '' ? sns.userHomepage : '입력된 개인 홈페이지 링크가 없습니다.'}"></div>
                </li>
              </ul>
            </div>
            <div class="edit-wrapper">
              <button class="edit-button" id="editButton_sns">수정</button>
            </div>
          </div>

          <!-- 숨겨진 항목 (수정 버튼 클릭시 나오는 영역) -->
          <div class="contents" id="snsInfo_e" style="display: none;">
            <form class="edit_SnsForm" method="post" id="editForm3"
                  th:action="@{/members/setPage/{memberId}/edit3(memberId=${member.memberId})}">
                <ul class="sns_textSet">
                    <li class="snsBox">
                      <img class="icons" src="/setPage/img/email-icon.svg" onerror="this.src='/kdy/imgs/noImage.png'" alt="email">
                      <input name="userEmail" class="snsButton sns_editBox" id="snsEmail_e"
                             placeholder="이메일을 입력하세요."
                             value="" th:value="${member.userEmail}">

                    </li>
                    <li class="snsBox">
                      <img class="icons" src="/setPage/img/github-icon.svg" onerror="this.src='/kdy/imgs/noImage.png'" alt="Github">
                      <input name="userGithub" class="snsButton sns_editBox"
                              id="snsGithub_e"
                              placeholder="Github 계정을 입력하세요." 
                              value="" th:value="${sns.userGithub}">
                    </li>
                    <li class="snsBox">
                      <img class="icons" src="/setPage/img/twitter-icon.svg" onerror="this.src='/kdy/imgs/noImage.png'" alt="twitter">
                      <input name="userTwitter" class="snsButton sns_editBox"
                            id="snsTwitter_e"
                            placeholder="Twitter 계정을 입력하세요." 
                            value="" th:value="${sns.userTwitter}">
                    </li>
                    <li class="snsBox">
                      <img class="icons" src="/setPage/img/facebook-icon.svg" onerror="this.src='/kdy/imgs/noImage.png'" alt="facebook">
                        <div tabindex="0" class="facebookBox">
                          <span>https://www.facebook.com/</span>
                          <input name="userFacebook" value="" id="snsFacebook_e"
                                 th:value="${sns.userFacebook}">
                        </div>
                    </li>
                    <li class="snsBox">
                      <img class="icons" src="/setPage/img/home-icon.svg" onerror="this.src='/kdy/imgs/noImage.png'" alt="home">
                      <input name="userHomepage" class="snsButton sns_editBox"
                            id="snsHome_e"
                            placeholder="홈페이지 주소를 입력하세요." 
                            value="" th:value="${sns.userHomepage}">
                    </li>
                </ul>
                <div class="button-wrapper">
                  <button color="teal" class="save-button" id="save-btn-sns"> 저장 </button>
                </div>
            </form>
        </div>
          
        </div>
      </div>
      <div class="description">포스트 및 블로그에서 보여지는 프로필에 공개되는 소셜 정보입니다.</div>
    </div>

    <!-- 이메일 주소 영역 시작 -->
    <div class="pd p_dt" id="email-area">
      <div class="wrapper">
        <div class="title-wrapper">
          <h3>이메일 주소</h3>
        </div>
        <div class="block-set">
          <div class="contents" th:text="${member.userEmail}"> E-mail AREA </div>
        </div>
      </div>
      <div class="description">회원 인증 또는 시스템에서 발송하는 이메일을 수신하는 주소입니다.</div>
    </div>

    <!-- 이메일 수신 설정 영역 시작 -->
    <div class="pd p_dt" id="em-rcv-area">
      <div class="wrapper">
        <div class="title-wrapper">
          <h3>이메일 수신 설정</h3>
        </div>
        <div class="block-set">
          <div class="contents">
            <ul class="rcv-ul">
              <li>
                <span>댓글 알림</span>
                <div class="rcv-checklist">
                  <label class="toggleSwitch">
                    <span class="toggleButton"></span>
                  </label>
                </div>
              </li>
              <li>
                <span>벨로그 업데이트 소식</span>
                <div class="rcv-checklist">
                  <label class="toggleSwitch">
                    <span class="toggleButton"></span>
                  </label>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 회원 탈퇴 영역 시작 -->
    <div class="pd p_dt" id="del-ac">
      <div class="wrapper">
        <div class="title-wrapper">
          <h3>회원 탈퇴</h3>
        </div>
        <div class="block-set">
          <div class="contents">
            <button class="del-button" id="deleteAccount">회원 탈퇴</button>
          </div>
        </div>
      </div>
      <div class="description">탈퇴 시 작성하신 포스트 및 댓글이 모두 삭제되며 복구되지 않습니다.</div>
    </div>

    <div class="deleteAcFrame" style=" display: none;">
      <div class="alertFrame">
        <div class="aF_textFrame">
          <h3>회원 탈퇴</h3>
          <div class="message">정말로 탈퇴 하시겠습니까?</div>
          <div class="button-area">
            <button color="transparent" class="deleteAc_btn cancel_b">취소</button>
            <button color="teal" class="deleteAc_btn ok_b">확인</button>
          </div>
        </div>
      </div>
    </div>

  </section>
</main>
  </body>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  <script>
    // ===================== 헤더 추가 =====================
//     $(function() {
//       $("#header").load("/header/header.html");
//     });
    const tabItem = document.querySelectorAll(".tab-container__item");
    const tabContent = document.querySelectorAll(".content-container__content");

    tabItem.forEach((item) => {
      item.addEventListener("click", tabHandler);
    });
  </script>
  <script th:inline="javascript">
    // ===================== 프로필 이미지 업로드, 삭제 기능 =====================
    window.addEventListener('DOMContentLoaded', (event) => {
      const uploadButton = document.getElementById('UPB');
      const removeButton = document.getElementById('RMB');
      const profileImage = document.getElementById('profile-image');

      uploadButton.addEventListener('click', () => {
        // 이미지 업로드 버튼 클릭 시, 파일을 선택 창 띄우기
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.addEventListener('change', (event) => {
          const file = event.target.files[0];
          const reader = new FileReader();

          reader.addEventListener('load', (event) => {
            // 업로드된 파일로 프로필 이미지 소스를 업데이트
            profileImage.src = event.target.result;
          });
          reader.readAsDataURL(file);
        });
        input.click();
      });

      removeButton.addEventListener('click', () => {
        // 이미지 제거 버튼 클릭 시, 업로드 된 소스 삭제 (디폴트 이미지 설정해둠)
        profileImage.src = 'img/defaultImage.png';
      });
    });


    // ===================== info-area 수정 기능 (메인 프로필) =====================

    // 수정 버튼 클릭 이벤트 처리
    document.getElementById('editButton_Mp').addEventListener('click', function () {
      // 디폴트값 숨기고, 숨겨진 수정 폼 보이게 하기
      document.querySelector('#defInfo').style.display = 'none';
      document.querySelector('#defInfo_editForm').style.display = 'block';
    });

    // 기존 데이터 가져오기
    var vUsername = document.querySelector('.vUsername');
    var vUserBio = document.querySelector('.vUserBio');

    // 가져온 데이터를 폼에 설정하기
    document.querySelector('.vName_e').value = vUsername.innerText;
    document.querySelector('.vBio_e').value = vUserBio.innerText;

    // 저장 버튼 클릭 이벤트 처리
    document.querySelector('#save-btn-info').addEventListener('click', function (event) {
      event.preventDefault(); // 폼 제출 막기

      // 입력한 값을 가져와서 페이지에 반영하기
      var updateNameData = document.querySelector('.vName_e').value;
      vUsername.innerText = updateNameData;

      var updateBioData = document.querySelector('.vBio_e').value;
      vUserBio.innerText = updateBioData;

      // 수정폼 숨기기, 디폴트값 다시 띄우기
      document.querySelector('#defInfo').style.display = 'block';
      document.querySelector('#defInfo_editForm').style.display = 'none';

      document.querySelector('#editForm').submit();
    });

    // ===================== 벨로그 정보 수정 기능 (위와 같은 기능이니 주석 패스할게요~) =====================
      document.getElementById('editButton_vN').addEventListener('click', function () {
        document.querySelector('#vPageName').style.display = 'none';
        document.querySelector('#vPageName_editForm').style.display = 'block';
    });

    var vPageNameT = document.querySelector('#vPageNameT');
    var vPageNameT_e = document.querySelector('#vPageNameT_e');
    var vPageNameData = vPageNameT.innerText;
    vPageNameT_e.value = vPageNameData;

    document.querySelector('#save-btn-PageName').addEventListener('click', function(event) {
      event.preventDefault();

      var updatePageData = vPageNameT_e.value;
      vPageNameT.innerText = updatePageData;

      document.querySelector('#vPageName').style.display = 'flex';
      document.querySelector('#vPageName_editForm').style.display = 'none';

      document.querySelector('#editForm2').submit();
    });

    // ===================== 소셜 정보 수정 기능 =====================
      document.getElementById('editButton_sns').addEventListener('click', function () {
        document.querySelector('#snsInfo').style.display = 'none';
        document.querySelector('#snsInfo_e').style.display = 'block';      
    });

    var snsEmail = document.querySelector('#snsEmail');
    var snsGithub = document.querySelector('#snsGithub');
    var snsTwitter = document.querySelector('#snsTwitter');
    var snsFacebook = document.querySelector('#snsFacebook');
    var snsHome = document.querySelector('#snsHome');

    var snsEmail_e = document.querySelector('#snsEmail_e');
    var snsGithub_e = document.querySelector('#snsGithub_e');
    var snsTwitter_e = document.querySelector('#snsTwitter_e');
    var snsFacebook_e = document.querySelector('#snsFacebook_e');
    var snsHome_e = document.querySelector('#snsHome_e');

    var snsEmailData = snsEmail.innerText;
    var snsGithubData = snsGithub.innerText;
    var snsTwitterData = snsTwitter.innerText;
    var snsFacebookData = snsFacebook.innerText;
    var snsHomeData = snsHome.innerText;

    snsEmail_e.value = snsEmailData;
    snsGithub_e.value = snsGithubData;
    snsTwitter_e.value = snsTwitterData;
    snsFacebook_e.value = snsFacebookData;
    snsHome_e.value = snsHomeData;

    document.querySelector('#save-btn-sns').addEventListener('click', function(event){
      event.preventDefault();

      var updateEmailData = snsEmail_e.value;
      var updateGithubData = snsGithub_e.value;
      var updateTwitterData = snsTwitter_e.value;
      var updateFacebookData = snsFacebook_e.value;
      var updateHomeData = snsHome_e.value;

      snsEmail.innerText = updateEmailData;
      snsGithub.innerText = updateGithubData;
      snsTwitter.innerText = updateTwitterData;
      snsFacebook.innerText = updateFacebookData;
      snsHome.innerText = updateHomeData;

      document.querySelector('#snsInfo').style.display = 'flex';
      document.querySelector('#snsInfo_e').style.display = 'none';

      document.querySelector('#editForm3').submit();
    });

    // 회원 탈퇴 경고창 (못 생긴 거)

    // window.addEventListener('DOMContentLoaded', (event) => {
    //   const confirmDeleteAccount = document.getElementById('deleteAccount');
    //   confirmDeleteAccount.addEventListener('click', () => {
    //     const confirmation = confirm('정말 탈퇴하시겠습니까?');
    //     if (confirmation) {
    //       console.log('DeleteAC confirmed');
    //     } else {
    //       console.log('DeleteAC canceled');
    //     }
    //   });
    // });

    // ===================== 회원 탈퇴 경고창 (더 이쁜거로 만듦)  =====================
    window.addEventListener('DOMContentLoaded', (event) => {
      const deleteAccountButton = document.getElementById('deleteAccount');
      const deleteAcFrame = document.querySelector('.deleteAcFrame');
      const cancelBtn = document.querySelector('.cancel_b');
      const confirmBtn = document.querySelector('.ok_b');

      deleteAccountButton.addEventListener('click', () => {
        // deleteAccount 버튼이 클릭시 deleteAcFrame 등장
        deleteAcFrame.style.display = 'block';
      });

      cancelBtn.addEventListener('click', () => {
        // 취소 버튼이 클릭되었을 때 deleteAcFrame 숨김
        deleteAcFrame.style.display = 'none';
      });

      confirmBtn.addEventListener('click', () => {
        console.log('탈퇴가 확인되었습니다.');
        location.href="/members/delete/[[${memberId}]]";
        // 여기에 실제 탈퇴 작업을 수행하는 코드 추가
      });
    });

    // ===================== 토글 스위치 기능 =====================
    const toggleList = document.querySelectorAll(".toggleSwitch");

    toggleList.forEach(($toggle) => {
      $toggle.onclick = () => {
        $toggle.classList.toggle('active');
      }
    });
  </script>
  </html>